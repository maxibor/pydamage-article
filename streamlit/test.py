from pypmml import Model
import multiprocessing as mp
import os
from functools import partial

def predict(d, model_path):
    model = Model.load(model_path)
    print(model.predict(d))


if __name__ == '__main__':
    lst = [
        {'actual_cov':23.0, 'damage':0.01, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.05, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.1, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},
        {'actual_cov':23.0, 'damage':0.3, 'contiglength':45678},

    ]
    dirname = os.path.dirname(__file__)
    model_path = dirname + "/../models/pydamage_glm_model.pmml"
    # model = Model.load(model_path)

    # for d in lst:
    #     print(model.predict(d))
    predict_partial = partial(predict, model_path=model_path)
    with mp.Pool(4) as p:
        p.map(predict_partial, lst)